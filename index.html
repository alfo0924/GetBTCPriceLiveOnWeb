<!DOCTYPE html>
<html>
<head>
  <title>Live Bitcoin Chart</title>
  <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


  <link rel="apple-touch-icon-precomposed" loading="lazy" sizes="144x144" href="https://cryptologos.cc/logos/bitcoin-btc-logo.svg?v=032" aria-label="btcLogo in 144 times 144" alt="logo in paypal 144 times 144"  />
  <link rel="apple-touch-icon-precomposed" loading="lazy" sizes="114x114" href="https://cryptologos.cc/logos/bitcoin-btc-logo.svg?v=032" aria-label="btcLogo in 144 times 144" alt="logo in paypal 114 times 114"  />
  <link rel="apple-touch-icon-precomposed" loading="lazy" sizes="72x72" href="https://cryptologos.cc/logos/bitcoin-btc-logo.svg?v=032" aria-label="btcLogo in 72 times 72" alt="logo in paypal 72 times 72"  />
  <link rel="apple-touch-icon-precomposed" loading="lazy" href="https://cryptologos.cc/logos/bitcoin-btc-logo.svg?v=032" aria-label="LogoBTC " alt="BTC apple-touch-icon-precomposed " />
  <link rel="shortcut icon" loading="lazy" sizes="196x196" href="https://cryptologos.cc/logos/bitcoin-btc-logo.svg?v=032" aria-label="BTCLOGO in shortcut icon which on the top of navigation bar in browser" alt=" BTCLOGO in shortcut icon which on the top of navigation bar in browser " />
  <link rel="shortcut icon" loading="lazy" type="image/x-icon" href="https://cryptologos.cc/logos/bitcoin-btc-logo.svg?v=032" aria-label="Icon  of BTCLOGO whihc in  browser " alt="btcLogo" />
  <link rel="icon" loading="lazy" type="image/x-icon" href="https://cryptologos.cc/logos/bitcoin-btc-logo.svg?v=032" aria-label="logo-of-BTC in browser " alt="logo-of-BTC"/>

  <style>
    body {
      padding: 150px;
      background-color: rgba(222, 222, 222, 0.74);
      background-blend-mode: multiply;
      align-items: center;
      text-decoration: none;
      align-content: center;
      justify-content: center;
      text-align: center;
      text-transform: uppercase;
      font-weight: 700;
      font-size: 30px;
      color: rgb(35, 33, 33);
    }
    #pricesContainer
    {
      font-size: 20px;
    }
  </style>
</head>
<body>


<h1 style="text-transform: uppercase;"><img loading="lazy" src="https://cryptologos.cc/logos/bitcoin-btc-logo.svg?v=032" height="150" width="auto"> Bitcoin/usd</h1>
<div ><p id="price"></p></div>
<div class="tradingview-widget-container">
  <div id="tradingview_12345"></div>
</div>

<br>
<br>

<!-- Date input fields and search button -->
<label for="startDate">Start Date:</label>
<input type="date" id="startDate" name="startDate">
<label for="endDate">End Date:</label>
<input type="date" id="endDate" name="endDate">
<button onclick="searchByDateRange()">Search</button>

<!-- Container to display queried data -->
<div id="pricesContainer"></div>

<!-- JavaScript for handling date range search and displaying data -->
<script>
  function searchByDateRange() {
    var startDate = document.getElementById('startDate').value;
    var endDate = document.getElementById('endDate').value;

    console.log("Start Date:", startDate);
    console.log("End Date:", endDate);

    fetch(`/search?startDate=${startDate}&endDate=${endDate}`)
            .then(response => response.json())
            .then(data => {
              console.log("Response Data:", data);
              displayData(data, startDate, endDate); // Pass startDate and endDate to displayData function
            })
            .catch(error => console.error('Error:', error));
  }

  function displayData(data, startDate, endDate) {
    var pricesContainer = document.getElementById('pricesContainer');
    pricesContainer.innerHTML = ''; // Clear previous content

    // Display the selected date range
    var dateRangeElement = document.createElement('p');
    dateRangeElement.textContent = `Date Range: ${startDate} to ${endDate}`;
    pricesContainer.appendChild(dateRangeElement);

    // Display queried data
    if (data.length === 0) {
      var noDataElement = document.createElement('p');
      noDataElement.textContent = 'No data available for the selected date range.';
      pricesContainer.appendChild(noDataElement);
    } else {
      data.forEach(price => {
        var priceElement = document.createElement('p');
        priceElement.textContent = `| 日期 Date | : ${price.Date} | 收盤價 Close Price | : ${price.Close} | 量 Volume | : ${price.Volume}`;
        pricesContainer.appendChild(priceElement);
      });
    }
  }

  // Initialize TradingView chart
  new TradingView.widget({
    width: 980,
    height: 610,
    symbol: "BTCUSD",
    interval: "D",
    timezone: "Asia/Taipei",  // Changed timezone to Asia/Taipei
    theme: "light",
    style: 1,
    locale: "en",
    toolbar_bg: "#f1f3f6",
    enable_publishing: false,
    allow_symbol_change: true,
    container_id: "tradingview_12345"
  });


  //btc live price

  function getBitcoinPrice() {
    $.get("https://api.coindesk.com/v1/bpi/currentprice.json", function(data) {
      var price = data.bpi.USD.rate;
      var change = data.bpi.USD.change;
      var changePercent = data.bpi.USD.changesPercentage;
      $("#price").html(price + " usd" );
    });
  }
  getBitcoinPrice();
  setInterval(getBitcoinPrice,1000); // Refresh every minute
</script>

</body>
</html>
